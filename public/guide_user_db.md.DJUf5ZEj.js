import{_ as d,f as a,o as s,b1 as e}from"./chunks/framework.CfD84-nl.js";const T=JSON.parse('{"title":"文件元数据","description":"","frontmatter":{},"headers":[],"relativePath":"guide/user/db.md","filePath":"guide/user/db.md"}'),n={name:"guide/user/db.md"};function i(l,t,r,p,c,_){return s(),a("div",null,t[0]||(t[0]=[e('<h1 id="文件元数据" tabindex="-1">文件元数据 <a class="header-anchor" href="#文件元数据" aria-label="Permalink to &quot;文件元数据&quot;">​</a></h1><p>文件元数据的数据结构设计，项目使用时，自行实现 MetadataRepository 接口类并适配数据库，官方演示仓库仅默认提供 MySQL 实现。</p><h2 id="表设计" tabindex="-1">表设计 <a class="header-anchor" href="#表设计" aria-label="Permalink to &quot;表设计&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Name</th><th>Type</th><th>Length</th><th>Not Null</th><th>Virtual</th><th>Key</th><th>Comment</th></tr></thead><tbody><tr><td>id</td><td>bigint</td><td>20</td><td>True</td><td>False</td><td>True</td><td>自增ID</td></tr><tr><td>file_key</td><td>varchar</td><td>50</td><td>True</td><td>False</td><td></td><td>文件KEY</td></tr><tr><td>file_md5</td><td>varchar</td><td>50</td><td>False</td><td>False</td><td></td><td>文件MD5值</td></tr><tr><td>file_name</td><td>varchar</td><td>255</td><td>True</td><td>False</td><td></td><td>文件名</td></tr><tr><td>file_mime_type</td><td>varchar</td><td>128</td><td>False</td><td>False</td><td></td><td>MIME类型</td></tr><tr><td>file_suffix</td><td>varchar</td><td>20</td><td>False</td><td>False</td><td></td><td>文件后缀</td></tr><tr><td>file_size</td><td>bigint</td><td>20</td><td>False</td><td>False</td><td></td><td>文件大小</td></tr><tr><td>is_preview</td><td>tinyint</td><td>1</td><td>False</td><td>False</td><td></td><td>预览图 0:无 1:有</td></tr><tr><td>is_private</td><td>tinyint</td><td>1</td><td>False</td><td>False</td><td></td><td>是否私有 0:否 1:是</td></tr><tr><td>bucket</td><td>varchar</td><td>20</td><td>True</td><td>False</td><td></td><td>存储桶</td></tr><tr><td>bucket_path</td><td>varchar</td><td>20</td><td>True</td><td>False</td><td></td><td>存储桶路径</td></tr><tr><td>upload_id</td><td>varchar</td><td>255</td><td>False</td><td>False</td><td></td><td>上传任务id</td></tr><tr><td>is_finished</td><td>tinyint</td><td>1</td><td>True</td><td>False</td><td></td><td>状态 0:未完成 1:已完成</td></tr><tr><td>is_part</td><td>tinyint</td><td>1</td><td>False</td><td>False</td><td></td><td>是否分块 0:否 1:是</td></tr><tr><td>part_number</td><td>int</td><td>4</td><td>False</td><td>False</td><td></td><td>分块数量</td></tr><tr><td>create_time</td><td>datetime</td><td></td><td>True</td><td>False</td><td></td><td>创建时间</td></tr><tr><td>create_user</td><td>varchar</td><td>255</td><td>True</td><td>False</td><td></td><td>创建用户</td></tr><tr><td>update_time</td><td>datetime</td><td></td><td>True</td><td>False</td><td></td><td>更新时间</td></tr><tr><td>update_user</td><td>varchar</td><td>255</td><td>True</td><td>False</td><td></td><td>更新用户</td></tr></tbody></table><h2 id="部分字段解析" tabindex="-1">部分字段解析 <a class="header-anchor" href="#部分字段解析" aria-label="Permalink to &quot;部分字段解析&quot;">​</a></h2><ul><li>file_key 文件KEY，该字段全表唯一，为自动生成的32位UUID。每次上传文件均生成新的文件KEY，即便是秒传的相同MD5文件也会生成新的文件KEY。</li><li>file_md5 文件MD5值，该字段是文件的HASH值，用于对应实际在 minio 桶中存储的文件。</li><li>file_name 文件名，文件上传时本地原始文件名称，含扩展名。</li><li>file_mime_type 内容类型，根据文件名中的扩展名进行识别，对应 minio 桶中文件的 Content-Type 属性。</li><li>file_suffix 文件后缀，即扩展名。</li><li>bucket 和 bucket_path 存储桶和路径，用于保存文件在 minio 中存储的桶和路径，bucket + bucket_path + file_md5 即为文件在 minio 中的物理位置。</li><li>upload_id 上传任务id，对应 minio 官方 SDK 中 uploadTaskId 字段。在进行分片上传时生成该字段，断点续传时判断是否能续传也会用到该字段。</li><li>is_finished 状态，文件是否上传完成。</li></ul><h2 id="mysql脚本" tabindex="-1">MySQL脚本 <a class="header-anchor" href="#mysql脚本" aria-label="Permalink to &quot;MySQL脚本&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>CREATE TABLE `file_metadata_info` (</span></span>\n<span class="line"><span>  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT &#39;主键&#39;,</span></span>\n<span class="line"><span>  `file_key` varchar(50) NOT NULL COMMENT &#39;文件KEY&#39;,</span></span>\n<span class="line"><span>  `file_md5` varchar(50) DEFAULT NULL COMMENT &#39;文件md5&#39;,</span></span>\n<span class="line"><span>  `file_name` varchar(255) NOT NULL COMMENT &#39;文件名&#39;,</span></span>\n<span class="line"><span>  `file_mime_type` varchar(128) DEFAULT NULL COMMENT &#39;MIME类型&#39;,</span></span>\n<span class="line"><span>  `file_suffix` varchar(20) DEFAULT NULL COMMENT &#39;文件后缀&#39;,</span></span>\n<span class="line"><span>  `file_size` bigint(20) DEFAULT NULL COMMENT &#39;文件大小&#39;,</span></span>\n<span class="line"><span>  `is_preview` tinyint(1) DEFAULT &#39;0&#39; COMMENT &#39;预览图 0:无 1:有&#39;,</span></span>\n<span class="line"><span>  `is_private` tinyint(1) DEFAULT &#39;0&#39; COMMENT &#39;是否私有 0:否 1:是&#39;,</span></span>\n<span class="line"><span>  `bucket` varchar(20) NOT NULL COMMENT &#39;存储桶&#39;,</span></span>\n<span class="line"><span>  `bucket_path` varchar(20) NOT NULL COMMENT &#39;存储桶路径&#39;,</span></span>\n<span class="line"><span>  `upload_id` varchar(255) DEFAULT NULL COMMENT &#39;上传任务id&#39;,</span></span>\n<span class="line"><span>  `is_finished` tinyint(1) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;状态 0:未完成 1:已完成&#39;,</span></span>\n<span class="line"><span>  `is_part` tinyint(1) DEFAULT NULL COMMENT &#39;是否分块 0:否 1:是&#39;,</span></span>\n<span class="line"><span>  `part_number` int(4) DEFAULT NULL COMMENT &#39;分块数量&#39;,</span></span>\n<span class="line"><span>  `create_time` datetime NOT NULL COMMENT &#39;创建时间&#39;,</span></span>\n<span class="line"><span>  `create_user` varchar(255) NOT NULL COMMENT &#39;创建用户&#39;,</span></span>\n<span class="line"><span>  `update_time` datetime NOT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT &#39;更新时间&#39;,</span></span>\n<span class="line"><span>  `update_user` varchar(255) NOT NULL COMMENT &#39;更新用户&#39;,</span></span>\n<span class="line"><span>  PRIMARY KEY (`id`) USING BTREE,</span></span>\n<span class="line"><span>  KEY `INDEX_KEY` (`file_key`),</span></span>\n<span class="line"><span>  KEY `INDEX_MD5` (`file_md5`)</span></span>\n<span class="line"><span>) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT=&#39;文件元数据信息表&#39;;</span></span></code></pre></div>',8)]))}const u=d(n,[["render",i]]);export{T as __pageData,u as default};
